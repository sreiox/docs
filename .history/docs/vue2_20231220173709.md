# vue2

## 0. 原理解读

### vue2

#### defineProperty/get/set

```js
//Object.defineProperty(obj, 'foo', {configurable: true, writable: true, enumable: true})
function convert(obj){
    Object.keys(obj).forEach(key => {
        let initalValue = obj[key];
        Object.defineProperty(obj, key, {
            get () {
                return initalValue
            }
            set (newValue) {
                initalValue = newValue
            }
        })
    })
}
```

#### 依赖追踪（订阅者模式）

```js
window.Dep = Class Dep {
    constructor(){
        this.subscribers = new Set()
    }

    depend(){
        // 依赖收集
        if(activeUpdate){
            this.subscribers.add(activeUpdate)
        }
    }

    notify(){
        // 通知订阅者执行
        this.subscribers.forEach(sub => sub())
    }
}

let activeUpdate

function autorun(update){
    // activeUpdate本质记录正在执行
    function wrappedUpdate{
        activeUpdate = wrappedUpdate
        update()
        activeUpdate = null
    }

    wrappedUpdate()
}

const dep = new Dep()
autorun(() => {
    dep.depend()
})
```

```js
let state = { count: 0 }
// 首先对象通过defineproperty开启监控
obeserve(state)

autorun(() => {
    console.log(state.count)
})

state.count++
```